define("ProfileView",["jquery","underscore","backbone","TopicsView","TopicModel","text!../templates/profile.html","jqueryColor"],function(e,t,n,r,i,s){function c(e){return e.$topics=e.$el.find("#topics"),l||(l="api/1/"+e.model.attributes.screen_name+"/topics",e.topics.url=l),e.$topics[0]?(e.topics=new n.Collection,e.topics.url=l,e.topicView=new r({collection:e.topics,el:e.$topics[0],screen_name:e.model.attributes.screen_name})):delete e.$topics,e}var o,u,a,f,l;return o=n.View.extend({el:"#box",initialize:function(){var r=e("#JSONtopics"),i=this;this.$profile=this.$el.find("#profile"),this.topics=new n.Collection,this.template=t.template(s),f=e("#loading"),a=e(".newTopic"),r[0]&&!~window.location.hash.indexOf("topic")&&(this.JSONtopics=JSON.parse(r.val()),r.remove(),e("#loading").fadeOut(500,function(){c(i).topics.add(i.JSONtopics)}).addClass("stop"))},events:{"click .newTopic .new":"addTopic","keyup .newTopic .name":"updateCount","click #header .user .bye":"logout"},render:function(){var t=this.$el,n=this,r={user:this.model.attributes};this.$profile[0]||t.hide().html(this.template(r)).fadeIn(500,function(){f=e("#loading"),a=e(".newTopic"),n.$profile=n.$el.find("#profile"),n.JSONtopics||c(n).topics.fetch({success:function(){f.fadeOut(500,function(){n.topicView.renderAll()}).addClass("stop")},error:function(){f.addClass("error")}})})},addTopic:function(){var t=a.find(".name"),n=a.find(".load"),r=a.find(".new"),s=e.trim(t.val()),o=this,u;!s||s.length>140?t.css("background-color","#FCF8D0").animate({backgroundColor:"#fff"},1e3):(r.hide(),n.removeClass("hide"),t.val(""),this.updateCount(),u=new i({name:s,user_id:this.model.attributes.user_id}),u.save({wait:!0}),u.on("change",function(){c(o).topics.add(u),n.addClass("hide"),r.show()}))},updateCount:function(){var e;this.$countSpan||(this.$countSpan=a.find(".count span")),this.$newTopic||(this.$field=a.find(".name")),e=140-this.$field.val().length,e<0&&(e='<span style="color:red">'+e+"</span>"),this.$countSpan.html(e)},logout:function(e){e.preventDefault(),u.render({text:"Are you leaving now?",yes:"Yes!",no:"Nope"},function(){window.location.hash="logout"})},remove:function(e){var t=this.$el,n=this.$profile;t.fadeOut(500,function(){n.remove(),t.show(),typeof e=="function"&&e()})}}),o.setConfirmView=function(e){u=e,r.setConfirmView(u)},o})