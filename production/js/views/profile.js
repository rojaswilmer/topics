define("ProfileView",["jquery","underscore","backbone","TopicsView","TopicModel","text!../templates/profile.html","jqueryColor"],function(e,t,n,r,i,s){function c(e){return e.$topics=e.$el.find("#topics"),l||(l="api/1/"+e.model.attributes.screen_name+"/topics",e.topics.url=l),e.$topics[0]?(e.topics=new n.Collection,e.topics.url=l,e.topicView=new r({collection:e.topics,el:e.$topics[0],screen_name:e.model.attributes.screen_name})):delete e.$topics,e}var o,u,a,f,l;return o=n.View.extend({el:"#box",initialize:function(r){var i=e("#JSONtopics"),o=this;this.$profile=this.$el.find("#profile"),this.topics=new n.Collection,this.template=t.template(s),f=e("#loading"),a=e(".newTopic"),i[0]&&!~window.location.hash.indexOf("topic")&&(this.JSONtopics=JSON.parse(i.val()),i.remove(),e("#loading").fadeOut(500,function(){c(o).topics.add(o.JSONtopics)}).addClass("stop"))},events:{"click .newTopic .new":"addTopic","keyup .newTopic .name":"updateCount","click #header .user .bye":"logout"},render:function(t){var n=this.$el,r=this,i={user:this.model.attributes};this.$profile[0]||n.hide().html(this.template(i)).fadeIn(500,function(){f=e("#loading"),a=e(".newTopic"),r.$profile=r.$el.find("#profile"),r.JSONtopics||c(r).topics.fetch({success:function(){f.fadeOut(500,function(){r.topicView.renderAll()}).addClass("stop")},error:function(){f.addClass("error")}})})},addTopic:function(t){var n=this.$el,r=a.find(".name"),s=a.find(".load"),o=a.find(".new"),u=e.trim(r.val()),f=this.topics,l=this,h;!u||u.length>140?r.css("background-color","#FCF8D0").animate({backgroundColor:"#fff"},1e3):(o.hide(),s.removeClass("hide"),r.val(""),this.updateCount(),h=new i({name:u,user_id:this.model.attributes.user_id}),h.save({wait:!0}),h.on("change",function(){c(l).topics.add(h),s.addClass("hide"),o.show()}))},updateCount:function(e){var t;this.$countSpan||(this.$countSpan=a.find(".count span")),this.$newTopic||(this.$field=a.find(".name")),t=140-this.$field.val().length,t<0&&(t='<span style="color:red">'+t+"</span>"),this.$countSpan.html(t)},logout:function(e){e.preventDefault(),u.render({text:"Are you leaving now?",yes:"Yes!",no:"Nope"},function(){window.location.hash="logout"})},remove:function(e){var t=this.$el,n=this.$profile,r=this;t.fadeOut(500,function(){n.remove(),t.show(),e&&e()})}}),o.setConfirmView=function(e){u=e,r.setConfirmView(u)},o})